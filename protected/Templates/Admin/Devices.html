{% extends 'Index.html' %}

{% block main %}
    {% set width = {reg: 'col-7', office: 'col-15', devices: 'col-20', soft: 'col-10', host: 'col-15', module: 'col-10', comment: 'col-10', action: 'col-5'} %}
    <div class="row">
        <main class="devices">
            <div class="">
                <table id="fixed-header" class="bg-default table table-condensed table-bordered cust-table-striped no-cut-long-text">
                    <thead>
                        <tr class="text-middle text-center">
                            <th class="bg-primary {{ width.reg }}">Регион</th>
                            <th class="bg-primary {{ width.office }}">Офис</th>
                            <th class="bg-primary {{ width.host }}">hostname</th>
                            <th class="bg-primary {{ width.devices }}">Оборудование<a class="btn btn-success btn-xs btn-custom pull-right" href="/modal/addAppliance" role="button" data-action="get-popup" title="добавить устройство"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a></th>
                            <th class="bg-primary {{ width.soft }}">ПО</th>
                            <th class="bg-primary {{ width.module }}">Модуль (комментарий)</th>
                            <th class="bg-primary {{ width.comment }}">Комментарий</th>
                            <th class="bg-primary {{ width.action }}">Action</th>

                        </tr>
                    </thead>
                        <tbody>
                    {% for office in offices %}
                        {% for appliance in office.appliances %}
                            <tr>
                                {#Region#}
                                <td>{{ office.address.city.region.title }}</td>
                                {#Office#}
                                <td>{{ office.title }}</td>
                                {#Hostname#}
                                <td>{{ appliance.details.hostname }}
                                    {% set mngmnt = appliance.getManagementIp %}
                                    {% if false != mngmnt %}
                                    <div class="pull-right">
                                        <span ><a href="ssh://{{ mngmnt }}" >[ssh]</a></span>
                                    </div>
                                    {% endif %}
                                </td>
                                {#Platform#}
                                <td>
                                    <span class="lastUpdate" data-last-update-utc="{{ appliance.lastUpdateDateTime }}"></span>
                                    <span class="vendor">{{ appliance.platform.platform.vendor.title }}</span>
                                    {{ appliance.platform.platform.title }}
                                </td>
                                {#Software#}
                                <td>
                                    <span class="sw-title">{{ appliance.software.software.title }}</span>
                                    {{ appliance.software.version }}
                                </td>
                                {#ModuleItems#}
                                <td class="cell-container">
                                    <table class="inner table table-bordered">
                                        <tbody>
                                        {% for moduleItem in appliance.modules %}
                                            <tr>
                                                {% if moduleItem.notFound %}
                                                    {% set colorClass = "item-not-found" %}
                                                {% elseif moduleItem.inUse is defined and false == moduleItem.inUse %}
                                                    {% set colorClass = "item-not-use" %}
                                                {% else %}
                                                    {% set colorClass = "" %}
                                                {% endif %}
                                                <td class="{{ colorClass }}">
                                                    {{ moduleItem.module.title }}
                                                    {% if not moduleItem.comment is empty %}
                                                        <span class="comment">({{ moduleItem.comment }})</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                                {#Comment#}
                                <td>{{ appliance.comment }}</td>
                                {#Action#}
                                <td class="text-center">
                                    <a class="btn btn-success btn-xs" href="/modal/editAppliance?id={{ appliance.getPK }}" role="button" data-action="get-popup"><span class="glyphicon glyphicon-pencil" aria-hidden="true" title="редактировать устройство"></span></a>
                                    {% if user.level > 2 %}
                                    <a class="btn btn-danger btn-xs" href="/admin/delAppliance?id={{ appliance.getPK }}" role="button"
                                           data-action="delete"><span class="glyphicon glyphicon-trash" aria-hidden="true" title="удалить устройство"></span></a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}   {#appliances#}
                    {% endfor %}    {#offices#}
                    </tbody>
                </table>
            </div>
        </main>
    </div>
{% endblock %}

